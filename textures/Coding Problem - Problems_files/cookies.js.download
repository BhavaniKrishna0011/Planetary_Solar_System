const DAY_IN_MS=24*60*60*1e3;function setupIndexDB(){const e=indexedDB.open("cookie-consent",1);e.onupgradeneeded=(()=>{let n=e.result;if(!n.objectStoreNames.contains("consent")){n.createObjectStore("consent",{keyPath:"username"})}});e.onerror=(()=>console.error("indexDB",e.error));e.onsuccess=(()=>{let n=e.result;n.onversionchange=(()=>{n.close();window.location.reload()});cookieBannerHandler(n)})}function getFromIDB(e,n,o,t){let i=e.transaction(n,"readonly");let s=i.objectStore(n);let r=s.get(o);r.onsuccess=(()=>t(r.result,null));r.onerror=(()=>t(null,r.error))}function putToIDB(e,n,o,t){let i=e.transaction(n,"readwrite");let s=i.objectStore(n);let r=s.put(o);r.onsuccess=(()=>t(null));r.onerror=(()=>t(r.error))}const isUserConsentExpired=(e,n,o)=>e!==n||o+180*DAY_IN_MS<Date.now();const isLocalConsentExpired=(e,n,o)=>e!==n||o+20*DAY_IN_MS<Date.now();const hideCookieBanner=()=>{const e=document.getElementById("gdpr-cookie-notif");if(e){e.style.display="none"}};const showCookieBanner=()=>{const e=document.getElementById("gdpr-cookie-notif");if(e){e.style.display=""}};function cookieBannerHandler(e){const n="";const o=Drupal.settings.username||n;const t=Drupal.settings.user_consented_privacy_policy_version||"";const i=Date.parse(Drupal.settings.user_consented_privacy_policy_on)||0;const s=Drupal.settings.current_privacy_policy_version||"";const r=()=>{const r={username:n,timestamp:Date.now(),version:s};putToIDB(e,"consent",r,e=>{if(e){console.error("indexDB",e);return}});if(o&&isUserConsentExpired(t,s,i)){r.username=o;fetch("/api/user/cookie_consent",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","x-csrf-token":window.csrfToken},body:""})}hideCookieBanner()};if(o&&!isUserConsentExpired(t,s,i)){r()}else if(o&&isUserConsentExpired(t,s,i)){getFromIDB(e,"consent",n,e=>{e=e||{};if(Object.keys(e).length!==0){isLocalConsentExpired(e.version,s,e.timestamp)?showCookieBanner():r()}else{showCookieBanner()}})}else{getFromIDB(e,"consent",n,e=>{e=e||{};if(Object.keys(e).length!==0){isLocalConsentExpired(e.version,s,e.timestamp)&&showCookieBanner()}else{showCookieBanner()}})}if(document.getElementById("gdpr-i-love-cookies")){document.getElementById("gdpr-i-love-cookies").addEventListener("click",r)}}const CookieBannerMain=()=>{window.addEventListener("showCookieBanner",setupIndexDB);window.Drupal&&Drupal.settings.current_privacy_policy_version&&window.dispatchEvent(new Event("showCookieBanner"))};if(document.readyState==="complete"||document.readyState==="loaded"){CookieBannerMain()}else{document.addEventListener("DOMContentLoaded",CookieBannerMain)}function cCookie(e,n,o){if(typeof n!="undefined"){o=o||{};if(n===null){n="";o.expires=-1}let t="";if(o.expires&&(typeof o.expires=="number"||o.expires.toUTCString)){let e;if(typeof o.expires=="number"){e=new Date;e.setTime(e.getTime()+o.expires*DAY_IN_MS)}else{e=o.expires}t="; expires="+e.toUTCString()}let i=o.path?"; path="+o.path:"";let s=o.domain?"; domain="+o.domain:"";let r=o.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(n),t,i,s,r].join("")}else{let n=null;if(document.cookie&&document.cookie!==""){let o=document.cookie.split(";");for(let t=0;t<o.length;t++){let i=jQuery.trim(o[t]);if(i.substring(0,e.length+1)===e+"="){n=decodeURIComponent(i.substring(e.length+1));break}}}return n}}